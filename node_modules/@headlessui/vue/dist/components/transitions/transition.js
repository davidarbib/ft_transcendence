import{computed as y,defineComponent as D,h as I,inject as L,onMounted as T,onUnmounted as A,provide as H,ref as g,watch as X,watchEffect as E}from"vue";import{useId as Y}from"../../hooks/use-id.js";import{match as V}from"../../utils/match.js";import{Features as Z,omit as ee,render as P,RenderStrategy as f}from"../../utils/render.js";import{Reason as j,transition as M}from"./utils/transition.js";import{dom as U}from"../../utils/dom.js";import{useOpenClosedProvider as te,State as w,useOpenClosed as ne,hasOpenClosed as re}from"../../internal/open-closed.js";function d(e=""){return e.split(" ").filter(t=>t.trim().length>1)}let F=Symbol("TransitionContext");var ae=(a=>(a.Visible="visible",a.Hidden="hidden",a))(ae||{});function le(){return L(F,null)!==null}function ie(){let e=L(F,null);if(e===null)throw new Error("A <TransitionChild /> is used but it is missing a parent <TransitionRoot />.");return e}function se(){let e=L(R,null);if(e===null)throw new Error("A <TransitionChild /> is used but it is missing a parent <TransitionRoot />.");return e}let R=Symbol("NestingContext");function x(e){return"children"in e?x(e.children):e.value.filter(({state:t})=>t==="visible").length>0}function K(e){let t=g([]),a=g(!1);T(()=>a.value=!0),A(()=>a.value=!1);function s(r,n=f.Hidden){let l=t.value.findIndex(({id:i})=>i===r);l!==-1&&(V(n,{[f.Unmount](){t.value.splice(l,1)},[f.Hidden](){t.value[l].state="hidden"}}),!x(t)&&a.value&&(e==null||e()))}function v(r){let n=t.value.find(({id:l})=>l===r);return n?n.state!=="visible"&&(n.state="visible"):t.value.push({id:r,state:"visible"}),()=>s(r,f.Unmount)}return{children:t,register:v,unregister:s}}let _=Z.RenderStrategy,oe=D({props:{as:{type:[Object,String],default:"div"},show:{type:[Boolean],default:null},unmount:{type:[Boolean],default:!0},appear:{type:[Boolean],default:!1},enter:{type:[String],default:""},enterFrom:{type:[String],default:""},enterTo:{type:[String],default:""},entered:{type:[String],default:""},leave:{type:[String],default:""},leaveFrom:{type:[String],default:""},leaveTo:{type:[String],default:""}},emits:{beforeEnter:()=>!0,afterEnter:()=>!0,beforeLeave:()=>!0,afterLeave:()=>!0},setup(e,{emit:t,attrs:a,slots:s,expose:v}){if(!le()&&re())return()=>I(fe,{...e,onBeforeEnter:()=>t("beforeEnter"),onAfterEnter:()=>t("afterEnter"),onBeforeLeave:()=>t("beforeLeave"),onAfterLeave:()=>t("afterLeave")},s);let r=g(null),n=g("visible"),l=y(()=>e.unmount?f.Unmount:f.Hidden);v({el:r,$el:r});let{show:i,appear:h}=ie(),{register:c,unregister:p}=se(),B={value:!0},m=Y(),S={value:!1},N=K(()=>{S.value||(n.value="hidden",p(m),t("afterLeave"))});T(()=>{let o=c(m);A(o)}),E(()=>{if(l.value===f.Hidden&&!!m){if(i&&n.value!=="visible"){n.value="visible";return}V(n.value,{["hidden"]:()=>p(m),["visible"]:()=>c(m)})}});let k=d(e.enter),$=d(e.enterFrom),q=d(e.enterTo),O=d(e.entered),z=d(e.leave),G=d(e.leaveFrom),J=d(e.leaveTo);T(()=>{E(()=>{if(n.value==="visible"){let o=U(r);if(o instanceof Comment&&o.data==="")throw new Error("Did you forget to passthrough the `ref` to the actual DOM node?")}})});function Q(o){let C=B.value&&!h.value,u=U(r);!u||!(u instanceof HTMLElement)||C||(S.value=!0,i.value&&t("beforeEnter"),i.value||t("beforeLeave"),o(i.value?M(u,k,$,q,O,b=>{S.value=!1,b===j.Finished&&t("afterEnter")}):M(u,z,G,J,O,b=>{S.value=!1,b===j.Finished&&(x(N)||(n.value="hidden",p(m),t("afterLeave")))})))}return T(()=>{X([i,h],(o,C,u)=>{Q(u),B.value=!1},{immediate:!0})}),H(R,N),te(y(()=>V(n.value,{["visible"]:w.Open,["hidden"]:w.Closed}))),()=>{let{appear:o,show:C,enter:u,enterFrom:b,enterTo:de,entered:ve,leave:pe,leaveFrom:me,leaveTo:Te,...W}=e;return P({props:{...W,...{ref:r}},slot:{},slots:s,attrs:a,features:_,visible:n.value==="visible",name:"TransitionChild"})}}}),ue=oe,fe=D({inheritAttrs:!1,props:{as:{type:[Object,String],default:"div"},show:{type:[Boolean],default:null},unmount:{type:[Boolean],default:!0},appear:{type:[Boolean],default:!1},enter:{type:[String],default:""},enterFrom:{type:[String],default:""},enterTo:{type:[String],default:""},entered:{type:[String],default:""},leave:{type:[String],default:""},leaveFrom:{type:[String],default:""},leaveTo:{type:[String],default:""}},emits:{beforeEnter:()=>!0,afterEnter:()=>!0,beforeLeave:()=>!0,afterLeave:()=>!0},setup(e,{emit:t,attrs:a,slots:s}){let v=ne(),r=y(()=>e.show===null&&v!==null?V(v.value,{[w.Open]:!0,[w.Closed]:!1}):e.show);E(()=>{if(![!0,!1].includes(r.value))throw new Error('A <Transition /> is used but it is missing a `:show="true | false"` prop.')});let n=g(r.value?"visible":"hidden"),l=K(()=>{n.value="hidden"}),i={value:!0},h={show:r,appear:y(()=>e.appear||!i.value)};return T(()=>{E(()=>{i.value=!1,r.value?n.value="visible":x(l)||(n.value="hidden")})}),H(R,l),H(F,h),()=>{let c=ee(e,["show","appear","unmount"]),p={unmount:e.unmount};return P({props:{...p,as:"template"},slot:{},slots:{...s,default:()=>[I(ue,{onBeforeEnter:()=>t("beforeEnter"),onAfterEnter:()=>t("afterEnter"),onBeforeLeave:()=>t("beforeLeave"),onAfterLeave:()=>t("afterLeave"),...a,...p,...c},s.default)]},attrs:{},features:_,visible:n.value==="visible",name:"Transition"})}}});export{oe as TransitionChild,fe as TransitionRoot};
