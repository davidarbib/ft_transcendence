import{computed as f,defineComponent as h,h as y,inject as $,nextTick as J,onMounted as j,onUnmounted as Q,provide as X,ref as D,watchEffect as A}from"vue";import{render as O,Features as L}from"../../utils/render.js";import{Keys as Z}from"../../keyboard.js";import{useId as b}from"../../hooks/use-id.js";import{useFocusTrap as ee,Features as w}from"../../hooks/use-focus-trap.js";import{useInertOthers as te}from"../../hooks/use-inert-others.js";import{Portal as H,PortalGroup as le}from"../portal/portal.js";import{StackMessage as W,useStackProvider as oe}from"../../internal/stack-context.js";import{match as E}from"../../utils/match.js";import{ForcePortalRoot as F}from"../../internal/portal-force-root.js";import{Description as ne,useDescriptions as ae}from"../description/description.js";import{dom as re}from"../../utils/dom.js";import{useOpenClosed as ie,State as K}from"../../internal/open-closed.js";import{useOutsideClick as ue,Features as se}from"../../hooks/use-outside-click.js";import{getOwnerDocument as pe}from"../../utils/owner.js";import{useEventListener as de}from"../../hooks/use-event-listener.js";var fe=(e=>(e[e.Open=0]="Open",e[e.Closed=1]="Closed",e))(fe||{});let x=Symbol("DialogContext");function P(o){let r=$(x,null);if(r===null){let e=new Error(`<${o} /> is missing a parent <Dialog /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(e,P),e}return r}let T="DC8F892D-2EBD-447C-A4C8-A03058436FF4",Me=h({name:"Dialog",inheritAttrs:!1,props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},open:{type:[Boolean,String],default:T},initialFocus:{type:Object,default:null}},emits:{close:o=>!0},setup(o,{emit:r,attrs:e,slots:i,expose:s}){var M;let p=D(0),a=ie(),m=f(()=>o.open===T&&a!==null?E(a.value,{[K.Open]:!0,[K.Closed]:!1}):o.open),S=D(new Set),d=D(null),k=f(()=>pe(d));if(s({el:d,$el:d}),!(o.open!==T||a!==null))throw new Error("You forgot to provide an `open` prop to the `Dialog`.");if(typeof m.value!="boolean")throw new Error(`You provided an \`open\` prop to the \`Dialog\`, but the value is not a boolean. Received: ${m.value===T?void 0:o.open}`);let c=f(()=>m.value?0:1),I=f(()=>c.value===0),R=f(()=>p.value>1),_=$(x,null)!==null,N=f(()=>R.value?"parent":"leaf"),U=ee(d,f(()=>I.value?E(N.value,{parent:w.RestoreFocus,leaf:w.All&~w.FocusLock}):w.None),f(()=>({initialFocus:D(o.initialFocus),containers:S})));te(d,f(()=>R.value?I.value:!1)),oe({type:"Dialog",element:d,onUpdate:(t,l,n)=>{if(l==="Dialog")return E(t,{[W.Add](){S.value.add(n),p.value+=1},[W.Remove](){S.value.delete(n),p.value-=1}})}});let V=ae({name:"DialogDescription",slot:f(()=>({open:m.value}))}),Y=`headlessui-dialog-${b()}`,C=D(null),v={titleId:C,panelRef:D(null),dialogState:c,setTitleId(t){C.value!==t&&(C.value=t)},close(){r("close",!1)}};X(x,v),ue(()=>{var l,n,g;return[...Array.from((n=(l=k.value)==null?void 0:l.querySelectorAll("body > *"))!=null?n:[]).filter(u=>!(!(u instanceof HTMLElement)||u.contains(U.value)||v.panelRef.value&&u.contains(v.panelRef.value))),(g=v.panelRef.value)!=null?g:d.value]},(t,l)=>{c.value===0&&(R.value||(v.close(),J(()=>l==null?void 0:l.focus())))},se.IgnoreScrollbars),de((M=k.value)==null?void 0:M.defaultView,"keydown",t=>{t.key===Z.Escape&&c.value===0&&(R.value||(t.preventDefault(),t.stopPropagation(),v.close()))}),A(t=>{var B;if(c.value!==0||_)return;let l=k.value;if(!l)return;let n=l==null?void 0:l.documentElement,g=(B=l.defaultView)!=null?B:window,u=n.style.overflow,G=n.style.paddingRight,z=g.innerWidth-n.clientWidth;n.style.overflow="hidden",n.style.paddingRight=`${z}px`,t(()=>{n.style.overflow=u,n.style.paddingRight=G})}),A(t=>{if(c.value!==0)return;let l=re(d);if(!l)return;let n=new IntersectionObserver(g=>{for(let u of g)u.boundingClientRect.x===0&&u.boundingClientRect.y===0&&u.boundingClientRect.width===0&&u.boundingClientRect.height===0&&v.close()});n.observe(l),t(()=>n.disconnect())});function q(t){t.stopPropagation()}return()=>{let t={...e,ref:d,id:Y,role:"dialog","aria-modal":c.value===0?!0:void 0,"aria-labelledby":C.value,"aria-describedby":V.value,onClick:q},{open:l,initialFocus:n,...g}=o,u={open:c.value===0};return y(F,{force:!0},()=>y(H,()=>y(le,{target:d.value},()=>y(F,{force:!1},()=>O({props:{...g,...t},slot:u,attrs:e,slots:i,visible:c.value===0,features:L.RenderStrategy|L.Static,name:"Dialog"})))))}}}),Be=h({name:"DialogOverlay",props:{as:{type:[Object,String],default:"div"}},setup(o,{attrs:r,slots:e}){let i=P("DialogOverlay"),s=`headlessui-dialog-overlay-${b()}`;function p(a){a.target===a.currentTarget&&(a.preventDefault(),a.stopPropagation(),i.close())}return()=>O({props:{...o,...{id:s,"aria-hidden":!0,onClick:p}},slot:{open:i.dialogState.value===0},attrs:r,slots:e,name:"DialogOverlay"})}}),$e=h({name:"DialogBackdrop",props:{as:{type:[Object,String],default:"div"}},inheritAttrs:!1,setup(o,{attrs:r,slots:e,expose:i}){let s=P("DialogBackdrop"),p=`headlessui-dialog-backdrop-${b()}`,a=D(null);return i({el:a,$el:a}),j(()=>{if(s.panelRef.value===null)throw new Error("A <DialogBackdrop /> component is being used, but a <DialogPanel /> component is missing.")}),()=>{let m=o,S={id:p,ref:a,"aria-hidden":!0};return y(F,{force:!0},()=>y(H,()=>O({props:{...r,...m,...S},slot:{open:s.dialogState.value===0},attrs:r,slots:e,name:"DialogBackdrop"})))}}}),je=h({name:"DialogPanel",props:{as:{type:[Object,String],default:"div"}},setup(o,{attrs:r,slots:e}){let i=P("DialogPanel"),s=`headlessui-dialog-panel-${b()}`;return()=>{let p={id:s,ref:i.panelRef};return O({props:{...o,...p},slot:{open:i.dialogState.value===0},attrs:r,slots:e,name:"DialogPanel"})}}}),Ae=h({name:"DialogTitle",props:{as:{type:[Object,String],default:"h2"}},setup(o,{attrs:r,slots:e}){let i=P("DialogTitle"),s=`headlessui-dialog-title-${b()}`;return j(()=>{i.setTitleId(s),Q(()=>i.setTitleId(null))}),()=>O({props:{...o,...{id:s}},slot:{open:i.dialogState.value===0},attrs:r,slots:e,name:"DialogTitle"})}}),Le=ne;export{Me as Dialog,$e as DialogBackdrop,Le as DialogDescription,Be as DialogOverlay,je as DialogPanel,Ae as DialogTitle};
