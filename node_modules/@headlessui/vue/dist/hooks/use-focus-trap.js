import{computed as L,onMounted as A,ref as E,watch as d}from"vue";import{Keys as D}from"../keyboard.js";import{focusElement as c,focusIn as w,Focus as T,FocusResult as k}from"../utils/focus-management.js";import{getOwnerDocument as I}from"../utils/owner.js";import{useEventListener as y}from"./use-event-listener.js";import{dom as S}from"../utils/dom.js";var g=(e=>(e[e.None=1]="None",e[e.InitialFocus=2]="InitialFocus",e[e.TabLock=4]="TabLock",e[e.FocusLock=8]="FocusLock",e[e.RestoreFocus=16]="RestoreFocus",e[e.All=30]="All",e))(g||{});function W(r,f=E(30),i=E({})){var H,R;let a=E(null),o=E(null),v={value:!1},e=L(()=>Boolean(f.value&16)),M=L(()=>Boolean(f.value&2)),s=L(()=>I(r));return A(()=>{d(e,(t,l)=>{var u;t!==l&&(!e.value||(v.value=!0,a.value||(a.value=(u=s.value)==null?void 0:u.activeElement)))},{immediate:!0}),d(e,(t,l,u)=>{t!==l&&(!e.value||u(()=>{v.value!==!1&&(v.value=!1,c(a.value),a.value=null)}))},{immediate:!0}),d([r,i,i.value.initialFocus,M],(t,l)=>{var p,F;if(t.every((b,h)=>(l==null?void 0:l[h])===b)||!M.value)return;let u=r.value;if(!u)return;let n=S(i.value.initialFocus),m=(p=s.value)==null?void 0:p.activeElement;if(n){if(n===m){o.value=m;return}}else if(u.contains(m)){o.value=m;return}n?c(n):w(u,T.First)===k.Error&&console.warn("There are no focusable elements inside the <FocusTrap />"),o.value=(F=s.value)==null?void 0:F.activeElement},{immediate:!0})}),y((H=s.value)==null?void 0:H.defaultView,"keydown",t=>{var l;!(f.value&4)||!r.value||t.key===D.Tab&&(t.preventDefault(),w(r.value,(t.shiftKey?T.Previous:T.Next)|T.WrapAround)===k.Success&&(o.value=(l=s.value)==null?void 0:l.activeElement))}),y((R=s.value)==null?void 0:R.defaultView,"focus",t=>{var m;if(!(f.value&8))return;let l=new Set((m=i.value.containers)==null?void 0:m.value);if(l.add(r),!l.size)return;let u=o.value;if(!u||!v.value)return;let n=t.target;n&&n instanceof HTMLElement?x(l,n)?(o.value=n,c(n)):(t.preventDefault(),t.stopPropagation(),c(u)):c(o.value)},!0),a}function x(r,f){var i;for(let a of r)if((i=a.value)!=null&&i.contains(f))return!0;return!1}export{g as Features,W as useFocusTrap};
